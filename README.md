# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные

В приложении используются две сущности: **Товар** и **Покупатель**.  
Они описаны с помощью интерфейсов:

```ts
// Товар
interface IProduct {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  price: number | null;
}

// Покупатель
type TPayment = 'card' | 'cash';

interface IBuyer {
  payment: TPayment;
  address: string;
  email: string;
  phone: string;
}
```

Интерфейсы описывают структуру данных, которые используются в моделях приложения.  
`IProduct` хранит информацию о товаре: идентификатор, название, изображение, категорию, описание и цену.  
`IBuyer` описывает данные покупателя: выбранный способ оплаты, адрес, email и телефон.


## Модели данных

В приложении используются три модели данных, каждая отвечает за свою область: каталог товаров, корзина и данные покупателя.

### Класс Catalog

**Назначение:**  
Хранит массив всех товаров, а также выбранный товар для подробного отображения.

**Конструктор:**  
```ts
constructor()
```
Параметры не принимает.

**Поля класса:**  
- `products: IProduct[]` — массив товаров, доступных в приложении.  
- `selectedProduct: IProduct | null` — товар, выбранный для подробного просмотра.

**Методы:**  
- `setProducts(products: IProduct[]): void` — сохраняет массив товаров.  
- `getProducts(): IProduct[]` — возвращает массив товаров.  
- `getProductById(id: string): IProduct | undefined` — получает товар по его идентификатору.  
- `setSelectedProduct(product: IProduct): void` — сохраняет товар для подробного отображения.  
- `getSelectedProduct(): IProduct | null` — возвращает выбранный товар.


### Класс Cart

**Назначение:**  
Хранит массив товаров, которые пользователь добавил в корзину.

**Конструктор:**  
```ts
constructor()
```
Параметры не принимает.

**Поля класса:**  
- `items: IProduct[]` — массив товаров в корзине.

**Методы:**  
- `getItems(): IProduct[]` — возвращает массив товаров в корзине.  
- `addItem(product: IProduct): void` — добавляет товар в корзину.  
- `removeItem(productId: string): void` — удаляет товар по его идентификатору.  
- `clear(): void` — очищает корзину.  
- `getTotalPrice(): number` — возвращает суммарную стоимость всех товаров.  
- `getCount(): number` — возвращает количество товаров в корзине.  
- `hasItem(productId: string): boolean` — проверяет наличие товара по его идентификатору.


### Класс Buyer

**Назначение:**  
Хранит данные покупателя, необходимые для оформления заказа.

**Конструктор:**  
```ts
constructor()
```
Параметры не принимает.

**Поля класса:**  
- `payment: TPayment | null` — способ оплаты.  
- `address: string | null` — адрес доставки.  
- `email: string | null` — электронная почта.  
- `phone: string | null` — номер телефона.

**Методы:**  
- `setData(data: Partial<IBuyer>): void` — сохраняет данные покупателя. Позволяет обновить как все поля сразу, так и отдельные значения (например, только email или только адрес).  
- `getData(): IBuyer` — возвращает все данные покупателя.  
- `clear(): void` — очищает все данные покупателя.  
- `validate(): Record<string, string>` — проверяет корректность данных.  
  Возвращает объект с ошибками:  
  ```ts
  {
    payment?: string;
    address?: string;
    email?: string;
    phone?: string;
  }
  ```
  Если поле пустое или некорректное, в объект добавляется свойство с текстом ошибки. Если ошибок нет, свойство отсутствует.

**Пример работы метода `validate()`:**  
```ts
{
  payment: 'Не выбран вид оплаты',
  email: 'Укажите email'
}
```
Такой объект сообщает, что поля `payment` и `email` не прошли проверку, а `address` и `phone` валидны.

## Слой коммуникации

### Класс ApiService

Назначение:  
Отвечает за взаимодействие с сервером «Веб-ларёк». Класс использует композицию: получает экземпляр класса Api и через него делает запросы на сервер.

Конструктор:  
constructor(api: IApi) — принимает объект, соответствующий интерфейсу IApi.

Методы класса:  
- getProducts(): Promise<IProduct[]> — выполняет GET-запрос на эндпоинт /product/ и возвращает массив товаров.  
- sendOrder(buyer: IBuyer, items: IProduct[]): Promise<object> — выполняет POST-запрос на эндпоинт /order/, передавая данные покупателя и выбранные товары. 


## Слой представления (View)

Слой представления отвечает за отображение данных на странице и взаимодействие пользователя с интерфейсом. Каждый класс слоя View управляет своим блоком разметки, используя базовый класс `Component`. Компоненты реализуют логику отображения каталога, карточек товаров, корзины, модальных окон и форм ввода данных.

### Класс Header

**Назначение:**  
Отвечает за отображение шапки сайта, содержащей кнопку корзины со счётчиком количества товаров.

**Конструктор:**  
constructor(container: HTMLElement)  
Принимает корневой элемент шапки.

**Поля класса:**  
- `basketButton: HTMLButtonElement` — кнопка открытия корзины.  
- `counterElement: HTMLElement` — элемент для отображения количества товаров.

**Методы класса:**  
- `setCounter(value: number): void` — устанавливает значение счётчика товаров в корзине.  
- `render(data: HeaderData): HTMLElement` — отрисовывает шапку с текущими данными.

---

### Класс Gallery

**Назначение:**  
Отвечает за отображение каталога товаров на главной странице.

**Конструктор:**  
constructor(container: HTMLElement)  
Принимает контейнер для каталога.

**Поля класса:**  
- `catalogElement: HTMLElement` — корневой элемент каталога с карточками товаров.

**Методы класса:**  
- `setCatalog(items: HTMLElement[]): void` — устанавливает список карточек товаров.  
- `render(data: GalleryData): HTMLElement` — отрисовывает каталог на странице.

---

### Карточки товаров

Для отображения карточек товаров используется базовый класс `ProductCard`, от которого наследуются три специализированных класса:  
- карточка товара в каталоге (`CatalogProductCard`),  
- карточка товара в корзине (`BasketProductCard`),  
- карточка товара для подробного просмотра (`PreviewProductCard`).  

#### Класс ProductCard

**Назначение:**  
Базовый класс для всех карточек товаров. Реализует общую логику отображения изображения, названия, категории и цены.

**Конструктор:**  
constructor(container: HTMLElement)  
Принимает DOM-элемент карточки товара.

**Поля класса:**  
- `title: HTMLElement` — элемент с названием товара.  
- `price: HTMLElement` — элемент с ценой товара.  
- `image: HTMLImageElement` — элемент с изображением товара.  
- `category: HTMLElement` — элемент с категорией товара.  
- `button: HTMLButtonElement` — кнопка действия (“Купить”, “Удалить” и т.п.).  

**Методы класса:**  
- `setTitle(value: string): void` — устанавливает название товара.  
- `setPrice(value: number | null): void` — устанавливает цену товара или отображает “Бесценно”, если значение `null`.  
- `setImage(src: string, alt?: string): void` — задаёт изображение товара.  
- `setCategory(value: string): void` — отображает категорию товара.  
- `setButtonLabel(label: string): void` — изменяет текст кнопки.  
- `render(data: IProduct): HTMLElement` — отрисовывает карточку с переданными данными.

---

#### Класс CatalogProductCard

**Назначение:**  
Отображает карточку товара в каталоге.

**Особенности:**  
- Наследуется от `ProductCard`.  
- Содержит кнопку “Купить”.  
- При клике на карточку вызывает событие `'product:select'` для открытия модального окна с деталями товара.  
- При клике на кнопку “Купить” вызывает событие `'product:buy'`.

---

#### Класс BasketProductCard

**Назначение:**  
Отображает карточку товара внутри корзины.

**Особенности:**  
- Наследуется от `ProductCard`.  
- Содержит кнопку удаления товара.  
- При клике на кнопку вызывает событие `'cart:remove'`.  

---

#### Класс PreviewProductCard

**Назначение:**  
Отображает карточку товара в модальном окне при подробном просмотре.

**Особенности:**  
- Наследуется от `ProductCard`.  
- Отображает полное описание товара.  
- Содержит кнопку добавления в корзину или сообщение о недоступности покупки.

---

### Класс Basket

**Назначение:**  
Отвечает за отображение содержимого корзины, списка товаров и итоговой суммы заказа.

**Конструктор:**  
constructor(container: HTMLElement)  
Принимает контейнер корзины.

**Поля класса:**  
- `listElement: HTMLElement` — контейнер для карточек товаров.  
- `totalElement: HTMLElement` — элемент для отображения общей суммы заказа.  
- `buttonOrder: HTMLButtonElement` — кнопка оформления заказа.

**Методы класса:**  
- `setItems(items: HTMLElement[]): void` — обновляет список товаров в корзине.  
- `setTotal(total: number): void` — устанавливает общую сумму заказа.  
- `setButtonState(active: boolean): void` — активирует или блокирует кнопку оформления заказа.  
- `render(): HTMLElement` — отрисовывает корзину.

---

### Класс Modal

**Назначение:**  
Реализует функциональность модального окна. Модальное окно не имеет дочерних классов, так как в него вставляются отдельные компоненты (например, карточка товара или форма).

**Конструктор:**  
constructor(container: HTMLElement)  
Принимает элемент модального окна.

**Поля класса:**  
- `modalElement: HTMLElement` — корневой элемент модального окна.  
- `contentElement: HTMLElement` — контейнер для динамического содержимого.  
- `closeButton: HTMLButtonElement` — кнопка закрытия окна.

**Методы класса:**  
- `open(content: HTMLElement): void` — открывает модальное окно и вставляет переданный контент.  
- `close(): void` — закрывает окно.  
- `setContent(content: HTMLElement): void` — заменяет содержимое окна.

---

### Формы

Для ввода данных используются две формы — выбора способа оплаты и контактных данных.  
Общая логика вынесена в базовый класс `Form`.

#### Класс Form

**Назначение:**  
Базовый класс для всех форм приложения. Реализует общую логику валидации, обработки событий и отображения ошибок.

**Конструктор:**  
constructor(container: HTMLFormElement)  
Принимает DOM-элемент формы.

**Поля класса:**  
- `formElement: HTMLFormElement` — корневой элемент формы.  
- `submitButton: HTMLButtonElement` — кнопка отправки формы.  
- `errors: HTMLElement` — контейнер для сообщений об ошибках.

**Методы класса:**  
- `onSubmit(handler: (data: object) => void): void` — назначает обработчик отправки формы.  
- `setErrorMessage(field: string, message: string): void` — отображает сообщение об ошибке для конкретного поля.  
- `clearErrors(): void` — очищает ошибки формы.  
- `render(): HTMLElement` — отрисовывает форму.

---

#### Класс PaymentForm

**Назначение:**  
Форма выбора способа оплаты и ввода адреса доставки.

**Конструктор:**  
constructor(container: HTMLFormElement)  
Принимает DOM-элемент формы оплаты.

**Поля класса:**  
- `paymentOptions: NodeListOf<HTMLInputElement>` — список переключателей способов оплаты (“Картой”, “Наличными”).  
- `addressInput: HTMLInputElement` — поле ввода адреса.

**Методы класса:**  
- `setPayment(value: TPayment): void` — сохраняет выбранный способ оплаты.  
- `setAddress(value: string): void` — устанавливает адрес.  
- `validate(): Record<string, string>` — проверяет корректность заполнения полей формы.  

**Особенности:**  
- Наследуется от `Form`.  
- При изменении способа оплаты вызывает событие `'payment:change'`.  
- Валидирует заполненность адреса перед переходом к следующему шагу.

---

#### Класс ContactForm

**Назначение:**  
Форма ввода контактных данных пользователя — email и телефона.

**Конструктор:**  
constructor(container: HTMLFormElement)  
Принимает DOM-элемент формы контактов.

**Поля класса:**  
- `emailInput: HTMLInputElement` — поле ввода электронной почты.  
- `phoneInput: HTMLInputElement` — поле ввода телефона.

**Методы класса:**  
- `setEmail(value: string): void` — устанавливает значение email.  
- `setPhone(value: string): void` — устанавливает значение телефона.  
- `validate(): Record<string, string>` — проверяет корректность введённых данных.  

**Особенности:**  
- Наследуется от `Form`.  
- При успешной отправке вызывает событие `'order:submit'`.

---

### Класс OrderSuccess

**Назначение:**  
Отображает сообщение об успешном оформлении заказа с итоговой суммой покупки.

**Конструктор:**  
constructor(container: HTMLElement)  
Принимает контейнер блока подтверждения.

**Поля класса:**  
- `description: HTMLElement` — элемент с текстом благодарности.  
- `totalElement: HTMLElement` — элемент, отображающий итоговую сумму заказа.  
- `buttonClose: HTMLButtonElement` — кнопка закрытия окна подтверждения.

**Методы класса:**  
- `setTotal(total: number): void` — устанавливает сумму заказа.  
- `render(): HTMLElement` — отрисовывает сообщение об успешной покупке.

---

Таким образом, слой **View** включает набор классов, каждый из которых отвечает за свой участок интерфейса. Общие функции выделены в базовые классы `Component`, `ProductCard` и `Form`, обеспечивая единообразие и переиспользуемость представлений.

## События приложения (View -> Presenter / Application)

Ниже перечислены события, которые генерируются классами представления при взаимодействии пользователя с интерфейсом. Каждое событие должно быть обработано Презентером или другим слушателем в приложении.

- product:select  
  Описание: пользователь кликнул по карточке товара.  
  Данные: { element: HTMLElement } — DOM-элемент карточки, по которой кликнули.

- product:buy  
  Описание: пользователь инициировал покупку/добавление товара в корзину (кнопка в карточке каталога или в превью).  
  Данные: { element: HTMLElement } — DOM-элемент карточки, из которой инициирована покупка.

- cart:remove  
  Описание: пользователь нажал кнопку удаления товара в корзине.  
  Данные: { element: HTMLElement } — DOM-элемент карточки, которую нужно удалить из корзины.

- modal:open  
  Описание: запрос на открытие модального окна (например, открыть корзину или оформление).  
  Данные: { modal: string } — идентификатор/тип модального содержимого (например, 'cart', 'checkout').

- modal:opened  
  Описание: модальное окно было открыто (view уведомляет об этом).  
  Данные: {} — нет дополнительных данных.

- modal:close  
  Описание: запрос на закрытие модального окна.  
  Данные: {} — нет дополнительных данных.

- modal:closed  
  Описание: модальное окно было закрыто.  
  Данные: {} — нет дополнительных данных.

- form:submit  
  Описание: форма была отправлена (общий эвент базового Form).  
  Данные: { form: HTMLFormElement, data: FormData } — DOM-элемент формы и данные формы.

- payment:change  
  Описание: пользователь изменил вид оплаты в форме оплаты.  
  Данные: { payment: string } — выбранный способ оплаты ('card' | 'cash').

- order:submit  
  Описание: пользователь подтвердил оформление заказа (финальная отправка контактных данных).  
  Данные: { data: object } — данные контактов (email, phone) или объединённый объект заказа в зависимости от реализации презентера.

  ## Презентер

Презентер (Presenter) реализован в виде основного скрипта приложения (`main.ts`). Поскольку приложение одностраничное, выделенного класса презентера не создавали — вся логика страницы сосредоточена в `main.ts`. Такой подход выбран как достаточный и удобный для текущего объёма приложения.

### Подход и ответственность
- Презентер связывает **Модели** и **Представления**: подписывается на события, генерируемые моделями и представлениями, и вызывает методы моделей и представлений для обновления состояния и интерфейса.  
- Презентер **не** генерирует события: он только обрабатывает события, поступающие от слоя View и Models.  
- Перерисовка View выполняется **только** в двух случаях:
  1. при получении события от модели, уведомляющего о том, что данные изменились (например, `catalog:changed`, `cart:changed`, `buyer:changed`), или  
  2. при обработке события открытия модального окна (например, `modal:open`) — в этом случае презентер решает, какой контент показать в модальном окне и вызывает `modal.open(...)`.

### Что реализовано в `main.ts`
- Создан общий EventEmitter для обмена событиями между компонентами, моделями и презентером.  
- Модели (`Catalog`, `Cart`, `Buyer`) создаются с передачей этого EventEmitter, чтобы они могли эмитить события при изменениях данных.  
- Представления (Gallery, CatalogProductCard, PreviewProductCard, Modal, Header, Basket, PaymentForm, ContactForm, OrderSuccess и т.д.) создаются с передачей контейнеров DOM и EventEmitter, чтобы представления могли эмитить события о взаимодействии пользователя.  
- Презентер подписывается на все значимые события приложения (перечислены ниже) и выполняет обработку согласно бизнес-логике приложения (без генерации собственных событий).

### Обработанные события (основные)
**От моделей**
- `catalog:changed` — каталог обновлён (Presenter собирает карточки и отрисовывает Gallery).  
- `catalog:selected` — выбран товар для детального просмотра (Presenter формирует превью и открывает модальное окно).  
- `cart:changed` — корзина изменилась (Presenter обновляет Basket и Header).  
- `cart:cleared` — корзина очищена (Presenter обновляет представления).  
- `buyer:changed` — данные покупателя изменились (Presenter обновляет формы).  
- `buyer:cleared` — данные покупателя очищены.

**От представлений (View)**
- `product:select` — пользователь кликнул по карточке товара (Presenter устанавливает выбранный товар в модели).  
- `product:buy` — пользователь нажал «Купить» (Presenter добавляет товар в Cart).  
- `cart:remove` — пользователь нажал удалить в корзине (Presenter удаляет товар из Cart).  
- `modal:open` — пользователь запросил открытие модалки (Presenter решает, какой контент показать и вызывает `modal.open(...)`).  
- `modal:close` — пользователь запросил закрытие модалки (Presenter вызывает `modal.close()`).  
- `form:submit` — форма отправлена (Presenter обрабатывает шаги оформления: из формы оплаты переходит к форме контактов).  
- `payment:change` — пользователь изменил вид оплаты (Presenter сохраняет выбранный вид оплаты в Buyer).  
- `order:submit` — финальная отправка заказа (Presenter сохраняет данные покупателя, вызывает `ApiService.sendOrder`, при успехе очищает Cart и Buyer и открывает сообщение об успешном заказе).

### Примечания
- В `main.ts` удалён тестовый код, оставлен только код, отвечающий за загрузку каталога с сервера и сохранение товаров в модели (далее презентер обрабатывает события и управляет отображением).  
- Все действия с данными выполняются через модели (Presenter вызывает методы моделей). Представления изменяют только DOM и уведомляют Presenter через события.

